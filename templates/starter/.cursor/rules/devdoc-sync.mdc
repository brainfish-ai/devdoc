---
description: Rules for syncing documentation with context memory
globs: ["**/*.mdx", "**/docs.json"]
---

# Documentation Sync Rules

When asked to sync, update, or check documentation:

## Step 0: Read Context Memory

**First, read `.devdoc/context.json` if it exists:**

```json
{
  "product": { "name": "...", "type": "..." },
  "terminology": { "glossary": {}, "avoidTerms": [] },
  "documentation": { "voice": "...", "codeExamples": { "primaryLanguage": "..." } }
}
```

**Apply context throughout:**
- Use `product.name` for product references
- Apply `terminology.glossary` - use correct terms
- Avoid `terminology.avoidTerms` - flag these words
- Match `documentation.voice` when writing updates
- Use `documentation.codeExamples.primaryLanguage` for code

## Step 1: Locate Source Code

- If `docs.json` exists here → source code is in `../`
- If `package.json` + `src/` exist → you're at repo root
- Check `codebase.sourceLocation` in context.json if set

## Step 2: Get Documentation Type

**Read `docs.json` for `docType` field:**

```json
{ "docType": "api" }  // "internal" | "api" | "product"
```

**If `docType` is set:** Use that value automatically.

**If `docType` is NOT set, detect from structure:**
- Has `architecture/`, `development/` → "internal"
- Has `api-reference/`, `sdks/` → "api"
- Has `features/`, `tutorials/` → "product"

**If still unclear, ask and save to docs.json.**

## Step 3: Analysis Process

1. Compare documented APIs against source code exports
2. Verify code examples compile/run correctly
3. Check version numbers match package.json
4. Validate all internal links resolve
5. Identify new features needing documentation
6. **Check terminology** against context.json

## Step 4: Generate Report

```
## Documentation Sync Report

### Terminology Issues
- file.mdx:line → Uses "charge" instead of "payment"

### Outdated (Breaking)
- file.mdx → function signature changed

### Outdated (Minor)
- file.mdx → version outdated

### Missing Documentation
- New exports not documented

### Up to Date
- List of current files
```

## Step 5: Apply Updates

When updating:
- **Read template** from `.devdoc/templates/` for structure
- Use terminology from context.json
- Preserve existing explanations
- Add TODO markers for human review
- Update context.json with new learnings

## Type-Specific Checks

### For docType: "internal"
- Dev setup instructions still work
- Architecture diagrams match current code
- Internal tool versions are current

### For docType: "api"
- API endpoints match OpenAPI spec
- Auth examples are correct
- SDK versions are current
- Error codes are complete

### For docType: "product"
- Screenshots match current UI
- Feature descriptions are accurate
- Tutorials still work

## Common Outdated Patterns

- Function signatures that changed
- Removed or renamed exports
- Changed configuration options
- Updated CLI commands
- New required parameters
- Deprecated features still documented

## Update Patterns

### Changed Signature
Update the documented signature to match source.

### Removed Feature
Add deprecation warning:
```mdx
<Warning>
This feature was removed in vX.X.
</Warning>
```

### New Feature
Create stub with TODO:
```mdx
{/* TODO: Document this feature */}
```

### Wrong Terminology
Replace with correct term from context.json glossary.
