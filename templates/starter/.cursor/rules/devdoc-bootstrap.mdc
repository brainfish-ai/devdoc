---
description: Rules for bootstrapping documentation with context memory and API spec detection
globs: ["**/README.md", "**/package.json", "**/src/**", "**/lib/**"]
---

# Repository Analysis for Documentation

When asked to bootstrap or generate initial documentation:

## Step 1: Check Context Memory

**First, check if `.devdoc/context.json` exists:**

- **If populated:** Read and use existing context. Tell user: "Using existing product context."
- **If empty/missing:** Run Discovery Flow below.

## Step 2: Discovery Flow

### 2a. Locate Project

- If `docs.json` exists → you're in docs folder, source is in `../`
- If `package.json` + `src/` exist → you're at repo root
- Otherwise, ask user for source code path

### 2b. Scan for API Specs

**Search for OpenAPI:**
- `openapi.json`, `openapi.yaml`, `swagger.json`, `swagger.yaml`
- `**/openapi.*`, `**/swagger.*`

**Search for GraphQL:**
- `schema.graphql`, `schema.gql`
- `**/*.graphql`

**Store paths for import prompt.**

### 2c. Auto-Discover

Scan and extract:
- **README.md:** Product name, description, features
- **package.json:** Language, framework, dependencies
- **OpenAPI:** API style, base URL, auth, endpoint count
- **GraphQL:** Types, queries, mutations count
- **Source structure:** Key directories, conventions

### 2d. Ask Key Questions

1. **Documentation Type:**
   "What type of documentation?
   1. **internal** - Team setup, architecture
   2. **api** - API reference, SDKs for developers
   3. **product** - Feature guides for end users"

2. **Import API Spec (if found):**

   **For OpenAPI:**
   "Found OpenAPI spec at `{path}` with {n} endpoints.
   1. **Import** - Copy to api-reference/openapi.json
   2. **Reference** - Point to existing location
   3. **Skip** - Manual docs only"

   **For GraphQL:**
   "Found GraphQL schema at `{path}` with {n} types.
   1. **Import** - Copy to api-reference/schema.graphql
   2. **Reference** - Point to existing location  
   3. **Skip** - Manual docs only"

   **For Both:**
   "Found OpenAPI and GraphQL specs.
   1. **OpenAPI** - REST API playground
   2. **GraphQL** - GraphQL playground
   3. **Both** - Separate tabs for each
   4. **Skip** - Manual only"

3. **Target Audience:**
   "Who is your primary audience?"

4. **Terminology (optional):**
   "Any terms to use/avoid? Brand names? (Enter to skip)"

5. **Code Examples:**
   "Primary language for code examples?"

### 2e. Create Context Memory

Create `.devdoc/context.json`:

```json
{
  "$schema": "https://devdoc.sh/schemas/context.json",
  "version": "1.0",
  "lastUpdated": "[timestamp]",
  "product": {
    "name": "[discovered]",
    "description": "[discovered]",
    "type": "[api/sdk/platform/cli]",
    "targetAudience": "[from question]"
  },
  "api": {
    "style": "[REST/GraphQL if detected]",
    "specPath": "[imported spec path]",
    "baseUrl": "[from spec]",
    "authentication": { "type": "[from spec]" }
  },
  "codebase": {
    "language": "[detected]",
    "framework": "[detected]",
    "sourceLocation": "../"
  },
  "documentation": {
    "voice": "[based on docType]",
    "codeExamples": { "primaryLanguage": "[from question]" },
    "templates": {
      "guide": ".devdoc/templates/guide.md",
      "apiReference": ".devdoc/templates/api-reference.md"
    }
  }
}
```

## Step 3: Import API Spec

**For Import option:**
1. Copy spec to `api-reference/`
2. Validate spec format
3. Update context.json with spec info

**For Reference option:**
1. Note relative path for docs.json
2. Update context.json with spec info

## Step 4: Update docs.json

Add `docType` and API reference:

**OpenAPI:**
```json
{
  "docType": "api",
  "navigation": {
    "tabs": [
      { "tab": "Guides", "groups": [...] },
      { "tab": "API Reference", "type": "openapi", "spec": "api-reference/openapi.json" }
    ]
  }
}
```

**GraphQL:**
```json
{
  "docType": "api",
  "navigation": {
    "tabs": [
      { "tab": "Guides", "groups": [...] },
      { "tab": "GraphQL API", "type": "graphql", "schema": "api-reference/schema.graphql", "endpoint": "https://..." }
    ]
  }
}
```

## Step 5: Generate Documentation

**Before generating, always:**
1. Read `.devdoc/context.json`
2. Read appropriate template from `.devdoc/templates/`
3. Apply terminology from context
4. Use correct product name
5. Match voice to docType
6. Reference imported API spec

### docType: "internal"
```
docs/
├── .devdoc/context.json
├── docs.json (docType: "internal")
├── index.mdx
├── getting-started/
├── architecture/
├── development/
└── contributing.mdx
```
**Voice:** Technical, direct

### docType: "api"
```
docs/
├── .devdoc/context.json
├── docs.json (docType: "api")
├── index.mdx
├── quickstart.mdx
├── authentication.mdx
├── guides/
├── api-reference/
│   ├── openapi.json    # If imported
│   └── schema.graphql  # If imported
├── sdks/
└── changelog.mdx
```
**Voice:** Professional, code-focused

### docType: "product"
```
docs/
├── .devdoc/context.json
├── docs.json (docType: "product")
├── index.mdx
├── getting-started/
├── features/
├── tutorials/
├── troubleshooting/
└── release-notes.mdx
```
**Voice:** Friendly, non-technical

## Content Guidelines

| docType | Focus | Tone | Code |
|---------|-------|------|------|
| internal | Setup, architecture | Technical | Heavy |
| api | Endpoints, auth, examples | Professional | Heavy |
| product | Features, workflows | Friendly | Minimal |

## Quality Guidelines

- Use terminology from context.json consistently
- Read templates before generating each page type
- Extract real examples, don't fabricate
- Add TODO for sections needing review
- **Import existing API specs** instead of manual docs
- **Validate specs** before importing
- Update context.json if you learn new info
